  // Route pour mettre à jour l'heure de rappel des emails d'arrosage
  app.patch("/api/users/:id/reminder-time", isAuthenticated, async (req: Request, res: Response) => {
    try {
      const userId = parseInt(req.params.id);
      if (isNaN(userId)) {
        return res.status(400).json({ message: "ID d'utilisateur invalide" });
      }
      
      // Vérifier que l'utilisateur modifie bien son propre profil
      if (req.user?.id !== userId) {
        return res.status(403).json({ message: "Vous n'êtes pas autorisé à modifier ce paramètre" });
      }
      
      const { reminderTime } = req.body;
      
      // Validation simple du format heure (HH:MM)
      if (!reminderTime || !/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(reminderTime)) {
        return res.status(400).json({ message: "Format d'heure invalide. Utilisez HH:MM" });
      }
      
      const updatedUser = await storage.updateUser(userId, { reminderTime });
      
      if (!updatedUser) {
        return res.status(404).json({ message: "Utilisateur non trouvé" });
      }
      
      console.log(`Heure de rappel mise à jour pour l'utilisateur ${userId}: ${reminderTime}`);
      
      res.json({ 
        message: "Heure de rappel mise à jour avec succès",
        reminderTime: updatedUser.reminderTime
      });
    } catch (error: any) {
      console.error('Erreur lors de la mise à jour de l\'heure de rappel:', error);
      res.status(500).json({ message: "Erreur lors de la mise à jour de l'heure de rappel" });
    }
  });